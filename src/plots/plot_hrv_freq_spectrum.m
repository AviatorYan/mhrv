function [] = plot_hrv_freq_spectrum( ax, plot_data, varargin )
%PLOT_HRV_FREQ_SPECTRUM Plots the spectrums generated by hrv_freq.
%   ax: axes handle to plot to.
%   plot_data: struct returned from hrv_freq.
%

%% Input
p = inputParser;
p.addRequired('ax', @(x) isgraphics(x, 'axes'));
p.addRequired('plot_data', @isstruct);
p.addParameter('clear', false, @islogical);
p.addParameter('tag', default_axes_tag(mfilename), @ischar);

p.parse(ax, plot_data, varargin{:});
clear = p.Results.clear;
tag = p.Results.tag;

f_axis          = plot_data.f_axis;
pxx_lomb        = plot_data.pxx_lomb;
pxx_ar          = plot_data.pxx_ar;
pxx_welch       = plot_data.pxx_welch;
pxx_fft         = plot_data.pxx_fft;
vlf_band        = plot_data.vlf_band;
lf_band         = plot_data.lf_band;
hf_band         = plot_data.hf_band;
f_max           = plot_data.f_max;
t_win           = plot_data.t_win;
welch_overlap   = plot_data.welch_overlap;
ar_order        = plot_data.ar_order;
num_windows     = plot_data.num_windows;

%% Plot
if clear
    cla(ax);
end

legend_entries = {};

if ~isempty(pxx_lomb)
    semilogy(f_axis, pxx_lomb, 'Parent', ax); grid(ax, 'on'); hold(ax, 'on');
    legend_entries{end+1} = sprintf('Lomb (t_{win}=%.1fm, n_{win}=%d)', t_win/60, num_windows);
end
if ~isempty(pxx_ar)
    semilogy(f_axis, pxx_ar, 'Parent', ax); grid(ax, 'on'); hold(ax, 'on');
    legend_entries{end+1} = sprintf('AR (order=%d)', ar_order);
end
if ~isempty(pxx_welch)
    semilogy(f_axis, pxx_welch, 'Parent', ax); grid(ax, 'on'); hold(ax, 'on');
    legend_entries{end+1} = sprintf('Welch (t_{win}=%.1fm, %d%% ovl.)', t_win/60, welch_overlap);
end
if ~isempty(pxx_fft)
    semilogy(f_axis, pxx_fft, 'Parent', ax); grid(ax, 'on'); hold(ax, 'on');
    legend_entries{end+1} = sprintf('FFT (twin=%.1fm, nwin=%d)', t_win/60, num_windows);
end

% Vertical lines of frequency ranges
lw = 3; ls = ':'; lc = 'black';
xrange = [0,f_max*1.01];
yrange = [1e-5, 1e0];

line(vlf_band(1) * ones(1,2), yrange, 'Parent', ax, 'LineStyle', ls, 'Color', lc, 'LineWidth', lw);
line(lf_band(1)  * ones(1,2), yrange, 'Parent', ax, 'LineStyle', ls, 'Color', lc, 'LineWidth', lw);
line(hf_band(1)  * ones(1,2), yrange, 'Parent', ax, 'LineStyle', ls, 'Color', lc, 'LineWidth', lw);
line(hf_band(2)  * ones(1,2), yrange, 'Parent', ax, 'LineStyle', ls, 'Color', lc, 'LineWidth', lw);

xlim(ax, xrange); ylim(ax, yrange);

% Names of frequency ranges
text(vlf_band(1), yrange(2) * 0.5, ' VLF', 'Parent', ax);
text( lf_band(1), yrange(2) * 0.5,  ' LF', 'Parent', ax);
text( hf_band(1), yrange(2) * 0.5,  ' HF', 'Parent', ax);

legend_entries{end+1} = 'Freq. Band Limit';
legend(ax, legend_entries);
xlabel(ax, 'Frequency [hz]'); ylabel(ax, 'Log Power Density [s^2/Hz]');

%% Tag
ax.Tag = tag;

end

